JS解析Excel

1. `excel` 文件其实是一个 `zip` 包
2. 解析它就很清楚了，主要分三步：
   1. 使用 `js` 解压缩 `excel` 文件（jszip）
   2. 获取到其中的 `sheet` 文件内容，然后将 `xml` 数据解析出来（xml-js将xml转为json）
   3. 将数据转换成我们想要的形状

JS 实现网络测速

1. `navigator.connection`

   - `downlink` 属性：以 Mb/s 为单位的有效带宽，但如果距离上一个 http 请求间隔较长，这个数值并不准
   - `type`属性：当前设备联网的类型，网络切换时，会触发`onChange`，可以做一些提示等

2. 测量ping值

   ```react
   const Dashboard = React.memo(() => {
     const [ping, setPing] = useState<number>(0);
     const [count, setCount] = useState<number>(0);
     const [pingList, setPingList] = useState<number[]>([]);
     const [jitter, setJitter] = useState<number>(0);
   
     useEffect(() => {
       const timer = setInterval(() => {
         const img = new Image();
         const startTime = new Date().getTime();
         // 此处选择加载 github 的 favicon，大小为2.2kB
         img.src = `https://github.com/favicon.ico?d=${startTime}`;
         img.onload = () => {
           const endTime = new Date().getTime();
           const delta = endTime - startTime;
           if ((count + 1) % 5 === 0) {
             const maxPing = Math.max(delta, ...pingList);
             const minPing = Math.min(delta, ...pingList);
             setJitter(maxPing - minPing);
             setPingList([]);
           } else {
             setPingList(lastList => [...lastList, delta]);
           }
           setCount(count + 1);
           setPing(delta);
         };
         img.onerror = err => {
           console.log('error', err);
         };
       }, 3000);
       return () => clearInterval(timer);
     }, [count, pingList]);
   
     return (
       <PageContainer className={styles.dashboard}>
         <div className="text-center">
           <h1>欢迎使用 仓储管理系统</h1>
           <h1>PING: {ping}ms</h1>
           <h1>抖动: {jitter}ms</h1>
         </div>
       </PageContainer>
     );
   });
   ```

   - 3 秒测量一次 ping 值，拿到最近 5 次 ping 值后计算一次抖动值
   - 迅雷如何判断下载不影响正常浏览页面：下载的时候在不停做 ping，如果发现 ping 的延迟增加，就限制下载速度

3. 注意

   - 不要在页面加载的初始阶段就去测速，否则会影响 LCP 时间，建议等组件 mounted 后再测速
   - 若使用加载图片的方式测量，图片 url 应拼接时间戳，防止请求时直接使用缓存。