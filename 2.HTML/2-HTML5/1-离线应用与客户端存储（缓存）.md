# 离线应用
## 概述
1. 支持离线应用是HTML5的一个重点
1. 离线web应用
    设备不上网的情况下，也能运行
1. 开发离线web应用的步骤
    - 应用知道设备能不能上网
    - 应用可以访问一定资源
    - 本地有一块空间保存数据

## 离线检测
### navigator.onLine属性

1. true：设备能上网
2. false：设备离线
3. 关键是：浏览器必须知道设备能否访问网络

### online事件

1. 网络从离线变为在线

### offline事件

1. 从在线变为离线
2. 检测应用是否离线
3. 页面加载后，通过navigator.onLine获取初始的状态
4. 通过online和offline事件确定网络连接状态是否变化
5. 注意：要手工轮询onLine属性检测网络状态变化

## 



## 
# Storage

## 概述

1. H5一部分
1. 为了克服cookie带来的一些限制，当数据需要严格控制在客户端上时，无须持续将数据发给服务器
1. 主要目的
    - 提供在cookie之外存储会话数据的途径
    - 提供一种大量可跨会话存在数据的机制
包括两个对象
    - window.sessionStorage：给每个源一个独立的存储空间，浏览器打开状态时可用；
    - window.localStorage：浏览器关闭后再打开仍然存在

## Storage类型
1. 提供了最大的存储空间来存储名值对
1. 每个项目作为属性存储在这个对象上
1. 虽然可以用属性直接修改存储的值，但为避免某个键覆盖已有成员，建议使用方法访问数据

## sessionStorage对象

1. 页面卸载，则会被清除

## localStorage对象

1. 数据没有到期时间

## 主要方法

1. Storage.key(n)：返回第n个key
2. Storage.getItem(name)：根据name返回值
3. Storage.setItem(name,value)：设置name的值为value，如name存在，则更新值
4. Storage.removeItem(name)：删除
5. Storage.clear()：清空全部


## storage事件
1. 对Storage对象的任何修改，都会在文档上触发storage事件

	```javascript
	window.addEventListener('storage', () => {
		//
	});
	```

	


## 限制
1. 对存储空间大小的限制是以每个来源（协议、域、端口号）为单位的
1. 一般是5M或2.5M



# IndexedDB
## 概述

1. 用于客户端存储大量结构化数据

2. API使用索引来实现对该数据的高性能搜索

3. 虽然storage对于存储较少量的数据很有用，但对于存储更大量的结构化数据来说，这种方法不太有用；

4. indexedDB API是强大的，有些库如localForage，dexie.js，ZangoDB等会使IndexedDB更方便用户

5. window.indexedDB

	

## 数据库

1. 最大特色是：使用对象保存数据，而不是使用表来存储

1. 一个indexedDB数据库，就是一组位于相同命名空间下的对象集合

	

# Service Worker

## 概述

1. HTML5 API，主要用来做持久的离线缓存。
2. js运行在单线程上，由于web复杂度越来越高，性能逐渐凸显出来，Web Worker的API被创造出来，主要目的是解放主进程
	- 可以将耗时的任务给web worker，干完活通过posetMessage通知给主线程
	- 主线程通过 onMessage 方法得到 Web Worker 的结果反馈。
	- 但新的问题是，每次做的结果不能被保存，因此提出service workder
3. 功能和特性
	- 一个独立的 worker 线程，独立于当前网页进程，有自己独立的 worker context。
	- 一旦被 install，就永远存在，除非被手动 unregister
	- 用到的时候可以直接唤醒，不用的时候自动睡眠
	- 可编程拦截代理请求和返回，缓存文件，缓存的文件可以被网页进程取到（包括网络离线状态）
	- 离线内容开发者可控
	- 能向客户端推送消息
	- 不能直接操作 DOM
	- 必须在 HTTPS 环境下才能工作
	- 异步实现，内部大都是通过 Promise 实现

# PWA

## 什么是

1. Progressive Web App, 简称 PWA，是提升 Web App 的体验的一种新方法，能给用户原生应用的体验

2. PWA 本质上是 Web App，借助一些新技术也具备了 Native App 的一些特性，兼具 Web App 和 Native App 的优点。

3. 主要特点：

	- 可靠，即使在不稳定的网络环境下，通过service worker也能瞬间加载并展现
	- 体验：快速体验
	- 粘性：可以像原生应用一样添加到桌面

	

## 什么是渐进式

1. 主要是渐进式改善站点体验
	- 降低站点改造的代价，逐步支持各项新技术
	- 新技术标准的支持度还不完全




