渲染管线

1. 「渲染管线」(rendering pipeline)，又称图形学管线(graphics pipeline)，是计算机将 3D 模型渲染至 2D 屏幕上的一个概念模型。
2. 渲染管线一般仅指 3D 多边形渲染的渲染流程，是从物体发出光线，并最终落到视点。
   - 光线追踪是根据光路可逆原理，从视点发出光线，当其碰撞到物体表面时，根据表面材质计算出对应的颜色和光强，并继续计算反射与折射等，最终追溯到光源或无贡献点
3. 渲染管线一般分为 4 个部分，应用(Application)、几何处理(Geometry Processing)、光栅化(Rasterization) 和 像素处理(Pixel Processing)。不同资料、不同实现可能有不同的划分方法，但总体的流程是相似的。

## 应用阶段

1. 图元是基本可绘制单元，一般指 **「点、线段 和 三角形」**，其本质上是顶点的集合。比如线段就是两个顶点、三角形就是三个顶点。
2. 一般来说，图元最多只有三角形，因为它们总是有相同的顶点数，而且三个顶点可以确定一个平面，后续可以方便地将其视为一个二维平面来处理。
3. 如果有四个点，就需要额外的方法保证其在同一平面，且不产生凹多边形。

顶点的拓扑方式

1. 三角形条带：在 WebGPU 中，通过 pipeline 的 `primitive.topology`，可以指定顶点的拓扑方式（triangle-strip）

2. 一般来说，我们的模型都是由连续的三角形组成的，会有多个三角形共用顶点的情况，在描述顶点时，省略这些重复的顶点，这就是条带。

   ![图片](1-可视化入门.assets/640)

3. 三角形顶点是有顺序的，三角形顶点顺序是顺时针(cw)还是逆时针(ccw)，决定构成的整个三角面是面朝相机还是背朝相机

## 几何处理

1. 对图元进行处理，最终得到其在屏幕空间的坐标。

顶点着色 - Vertex Shading

1. 顶点着色是通过目前已有的信息，给这些顶点附加一些属性（比如颜色、材质、法线）或者做一些修改（比如调整位置、丢弃），确定顶点在画布上的位置
2. 比如webGpu，顶点着色器唯一做的就只是将 2 维数组 [x, y] 转换为只有位置 (x, y, z=0.0, w=1.0) 向量的最简单的顶点

坐标转换

1. 对于任意二维或三维空间上的点，我们都可以通过应用矩阵变换的方式，将其进行仿射(affine)变换，比如平移、缩放、拉伸 和 旋转。
2. 因此，在这个阶段，我们就通过一步步的矩阵坐标变换，来最终确定顶点在屏幕上的位置。

投影

1. 正交投影是平行投影的一种，这类投影最大的特点是 没有近大远小，平行线投影后还是平行的。
2. 透视投影的特点是，越远的物体看起来越小，平行线最终会交于一点。



屏幕映射 

1. 经过上述一系列处理后，我们会得到一个非常方的单位立方体，其中 (x, y, z) 都是 [-1, 1]。
2. 需要将标准化的设备坐标(Normalized device coordinate) 转换为屏幕坐标，比如 x 从 [-1, 1] => [0, 1024)， y 从 [-1, 1] => [0, 768)，也有一些实现会将 z 映射到 [0, 1]。



光栅化阶段

1. 经过光栅化后，我们可以确定哪些像素属于哪些图元，得到对应的片元。



像素处理阶段

1. 
