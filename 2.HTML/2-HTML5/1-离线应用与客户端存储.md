# 离线应用与客户端存储
## 概述
1. 支持离线应用是HTML5的一个重点
1. 离线web应用
    设备不上网的情况下，也能运行
1. 开发离线web应用的步骤
    - 应用知道设备能不能上网
    - 应用可以访问一定资源
    - 本地有一块空间保存数据

## 离线检测
### navigator.onLine属性

1. true：设备能上网
2. false：设备离线
3. 关键是：浏览器必须知道设备能否访问网络

### online事件

1. 网络从离线变为在线

### offline事件

1. 从在线变为离线
2. 检测应用是否离线
3. 页面加载后，通过navigator.onLine获取初始的状态
4. 通过online和offline事件确定网络连接状态是否变化
5. 注意：要手工轮询onLine属性检测网络状态变化

## 存储机制
### Cookie

#### 概述

1. 最初是在客户端用于存储会话信息，分担服务器存储负担的
1. 要求服务器对任意HTTP请求发送Set-Cookie HTTP头作为响应的一部分
1. cookie构成
    - 域，路径，失效时间，secure标志是服务器给浏览器的指示，以指定何时发送cookie，这些参数不发回服务器

#### js中的cookie

1. document.cookie
	- 返回当前页面可用的所有cookie字符串，一系列用分号隔开
	- 所有名都是用URL编码的
2. 创建Cookie
	- document.cookie="username=John Doe";
	- 可以配置存在时间，默认关闭浏览器清除
	- 可以配置path，默认当前网页
3. 读取Cookie
	- `var x = document.cookie`;
	- 会读取全部cookie
4. 改变Cookie：和创建一致，覆盖旧的cookie
5. 删除Cookie：设置存在时间为0
6. 子cookie
	- 为绕开浏览器单个域名的cooki限制
	- name=name1=value&name2=value
	- 浏览器存一个key为name，实际里面有两个key-value对
	- 删除子cookie，不能将key置""，需获得cookie下所有子cookie，然后再删除具体的

#### 优点

1. 极高的扩展性和可用性 
2. Cookie有效期限未到时，Cookie能使用户在不键入密码和用户名的情况下进入曾经浏览过的一些站点 
3. 主要是：解决浏览器用户与Web服务器之间无状态通信。

#### 缺点

1. cookie在性质上是绑定在特定的域名下的
2. `Cookie`数量和长度的限制。每个域的cookie总数是有限的，每个cookie长度不能超过4KB，否则会被截掉。
3. 安全性问题。如果cookie被人拦截了，那人就可以取得所有的session信息。即使加密也与事无补，因为拦截者并不需要知道cookie的意义，他只要原样转发cookie就可以达到目的了。
4. 由于所有的cookie都是由浏览器作为请求头发送，包含大量信息会无形中浪费了带宽

### Storage
#### 概述
1. H5一部分
1. 为了克服cookie带来的一些限制，当数据需要严格控制在客户端上时，无须持续将数据发给服务器
1. 主要目的
    - 提供在cookie之外存储会话数据的途径
    - 提供一种大量可跨会话存在数据的机制
包括两个对象
    - window.sessionStorage：给每个源一个独立的存储空间，浏览器打开状态时可用；
    - window.localStorage：浏览器关闭后再打开仍然存在

#### Storage类型
1. 提供了最大的存储空间来存储名值对
1. 每个项目作为属性存储在这个对象上
1. 虽然可以用属性直接修改存储的值，但为避免某个键覆盖已有成员，建议使用方法访问数据


#### sessionStorage对象
1. 页面卸载，则会被清除

#### localStorage对象
1. 数据没有到期时间

#### 主要方法

1. Storage.key(n)：返回第n个key
2. Storage.getItem(name)：根据name返回值
3. Storage.setItem(name,value)：设置name的值为value，如name存在，则更新值
4. Storage.removeItem(name)：删除
5. Storage.clear()：清空全部


#### storage事件
1. 对Storage对象的任何修改，都会在文档上触发storage事件

	```javascript
	window.addEventListener('storage', () => {
		//
	});
	```

	


#### 限制
1. 对存储空间大小的限制是以每个来源（协议、域、端口号）为单位的
1. 一般是5M或2.5M

### IndexedDB
#### 概述

1. 用于客户端存储大量结构化数据

2. API使用索引来实现对该数据的高性能搜索

3. 虽然storage对于存储较少量的数据很有用，但对于存储更大量的结构化数据来说，这种方法不太有用；

4. indexedDB API是强大的，有些库如localForage，dexie.js，ZangoDB等会使IndexedDB更方便用户

5. window.indexedDB

	

#### 数据库

1. 最大特色是：使用对象保存数据，而不是使用表来存储
1. 一个indexedDB数据库，就是一组位于相同命名空间下的对象集合








