# HTML5脚本编程
##　1、概述
1. h5之前主要是定义标记，与js相关的东西由DOM规范去定义；
1. 定义这些API，为了简化动态Web界面的工作
2. HTML5围绕如何使用新增标签定义了大量js API,其中一些API与DOM重叠，定义了浏览器应该支持的DOM扩展

## 2、DOM扩展
1. 与类相关的扩充
    - Class属性使用越来越多，HTML5新增很多API，致力于简化CSS类的用法
    - getElementByClassName
        - 返回带有指定类的所有元素的nodeList
        - 只有位于元素树中的会返回
    - classList属性
        - 在操作类名时，可以用className操作类名，但className是字符串，只修改字符串一个类名，也需要设置整个类名值
1. 焦点管理
    - document.activeElement属性
        - 最终会引用DOM中当前获得焦点的元素
        - 文档刚刚加载完，document.activeElement保存的是document.body元素的引用，文档加载期间这个值为null
    - document.hasFocus方法
        - 用于确定文档是否获得焦点
    - 无障碍web应用主要标志是恰当的焦点管理
1. HTMLDocument的扩展
    - 这些变化同样是基于已经得到很多浏览器完美支持的专有扩展
    - readyState属性
        - loading，正在加载文档
        - complete，已经加载完文档
        - 用法 if(document.readyState == " complete")
    - 兼容模式
        - ie6开始区分渲染模式是标准还是混杂
        - ie添加了compatMode属性，告诉开发者浏览器采用哪种渲染模式
        - document.compatMode的值为CSS1Compat：标准模式
        - document.compatMode的值为BackCompat：混杂模式
        - H5把这个属性纳入标准，并对其实现做了明确规定
    - head属性
        - document.head属性：引用文档的head元素
1. 字符集属性
    - charset属性
        - 表示文档实际使用的字符集
    - defaultCharset属性
        - 表示根据默认浏览器及操作系统的设置，当前文档默认的字符集是什么
1. 自定义数据属性
    - H5规范可以为元素添加非标准的属性，但要添加前缀data-
    - 可以任意命名，只要以data开头
    - dataset属性
        - 访问自定义属性值
        - key-value键值对，但key没有data前缀，如元素自定义属性为data-my，则可以div.dataset.my可以取得值
1. 插入标记
    - 概述
        - 需要为文档插入大量标记，通过DOM操作比较复杂
        - 使用插入标记的技术，直接插入HTML字符串不仅简单，速度更快，H5已结纳入规范
    - innerHTML属性
        - 读模式：返回全部子元素（注释，文本节点都会返回）
        - 写模式：创建新dom树，覆盖原来全部子元素
        - 不同浏览器返回的文本格式会不同
        - 并不是所有元素都支持innerHTML属性
    - outerHTML属性
        - 读模式：包含自身和子元素
        - 写模式：覆盖自身和子元素
    - insertAdjacentHTML()方法
        - 参数为要插入的位置和插入的文本
        - 插入位置必须是beforebegin，afterbegin，beforeend，afterend，并且必须是小写
    - 内存性能问题
        - 使用上述方法会导致内存问题，尤其是IE中
        - 在删除带事件处理程序或引用其他js对象树，就可能出现内存占用问题；因为元素虽然在dom树删了，但元素和事件的绑定关系并没有删除，还存在于内存中
        - 最好的办法是，首先手动删除要替换元素的所有事件处理程序和js对象属性
1. scrollIntoView()方法
	- 2017/8：实验性技术
    - 方便开发人员控制页面滚动
    - 调用元素会出现在视口中

## 2、跨文档信息传递
1. 跨文档信息传送，简称XDM，指来自不同域的页面间信息传递
1. 核心方法：postMessage()
    - 参数：一条信息
    - 参数：信息接收方来自哪个域的字符串
        - 保证安全通信，防止浏览器把信息发送到不安全的地方
1. 接收到XDM信息，会触发window对象的message事件
1. message事件包含的信息
    - data：作为postMessage()第一个参数传入的字符串
    - origin：发送信息的文档所在域
    - source：发送信息文档的window对象代理，不能通过这个代理访问window的其他信息
1. postMessage()最早设计是字符串，后来允许传入任何数据结构，为保险，最好传入字符串

## 3、原生拖拽
1. 概述
    - H5根据IE实例为基础制定了拖拽规范
1. 拖拽事件
    - 拖动元素依次会触发
        - dragstart:被拖拽元素上
        - drag:拖拽期间会持续触发
        - dragend:拖拽停止，无论是放置在有效目标还是无效目标上都触发
    - 当元素被放在有效位置
        - dragenter
        - dragover:拖拽目标在放置目标范围内移动，持续发生这个事件
        - dragleave:元素被拖出放置目标范围，会触发
        - drop:元素被放到放置目标范围内，会触发
1. 自定义放置目标
    - 在拖拽元素经过某些无效放置目标时，不允许放置
    - 无论用户如何操作，都不会发生drop事件
    - 可以阻止dragenter，dragover事件的默认行为
1. dataTransfer对象
    - 事件对象的属性，用于从拖拽元素向放置目标传递字符串格式的数据
    - getData()方法
    - setData()方法
    - 数据只能在drop事件中读取，如果没有读取到，说明datatransfer对象被销毁或数据丢失
    - 拖拽文本，浏览器会先用setData方法将文本设置到dataTransfer对象中，当文本拖拽到放置目标，再用getData方法读取数据
1. dropEffect与effectAllowed
    - dataTransfer对象属性
    - dropEffect
        - 可以知道被拖拽元素能够执行哪种放置行为
        - 不同值，元素到放置目标上的光标都不一样
        - 要使用这个属性，必须在dragenter事件处理程序中针对放置目标来设置它
        - 只有搭配effectAllowed属性才有用
    - effectAllowed
        - 允许拖拽元素的哪种dropEffect
        - 必须在dragestart事件中设置这个属性
1. 可拖动
    - 默认情况下，图像、链接任何时候都可拖拽，文本只有选中时候可以拖拽
    - draggable属性
        - 元素是否可拖拽
        - 通过设置这个属性，可以让某个元素默认拖拽属性改变
1. 其他成员
    - dataTransfer对象还有以下方法和属性
    - addElement(element)：为拖拽操作添加一个元素
    - clearData(format)：清除以特定格式保存的数据
    - setDragImage(element，x，y)：指定一幅图像，拖动发生时，显示在光标下方

## 4、媒体元素
1. 概述
    - 让开发人员不依赖任何插件就可以在网页中嵌入跨浏览器的音频和视频内容
    - `<video>,<audio>`
        - 至少要在标签中包含src属性，指向要加载的媒体文件
        - poster属性
            - 指定图像的URL，可在加载视频内容期间显示一幅图像
        - controls属性
            - 浏览器显示UI控件，以便用户操作媒体
        - 标签之间的内容作为后备内容，如浏览器不支持会显示
        - 可以使用`<source>`子标签，引入多个媒体来源，一般要指定多个
1. 属性
    - 通过属性可以知道媒体的当前状态
    - 很多属性可以在`<video><audio>`元素中直接设置
1. 事件
    - 事件很具体，为了让开发人员只使用少量HTML和js编写自定义播放器
1. 检测编码器的支持情况
    - canPlayType()方法
        - 接收一种格式/编解码器字符串，要用""引起来
        - 返回
            - probably
            - maybe
            - ""空字符串
                -  是假值
            - 真值
    - 媒体文件只不过是音频或视频的容器，决定文件能否播放的是编码格式
1. audio类型
    - 不用像Image一样必须插入文档中，创建新实例，并传入文件即可
    - 创建新实例并传入文件就开始下载，下载完，调用play方法就可播放音频

## 5、form表单（约束性验证API）
### 概述
1. 有了这些功能，即便js被禁用或由于某种原因未加载，也可以确保验证
1. 浏览器根据标记中的规则执行验证，显示适当的错误信息

### 必填字段
1. 表单字段指定required属性
1. js：通过required属性，可以查看某个字段是否为必填字段
1. 查看是否支持
    - "required" in document.createElement("input");
1. 对于空的必填，不同浏览器处理方式不同

### 其他输入类型
1. HTML为`<input>`元素的type增加了几个值
1. 支持最多的是(email和url)
1. 不支持的浏览器，会默认将未知type值设置为text

### 数值范围
1. 浏览器支持并不好
	`<input type="number" min="0" max="100" step="5" name="count">`
	设置输入的最小，最大，值是5的倍数

### 输入模式
1. pattern属性
1. 可以使用正则表达式，要求输入的必须符合某种格式
1. 模式的开头和末尾不用加^和$，是从头到尾匹配


### 检测有效性
1. checkValidity()方法
    - 检测表单中某个字段是否有效
    - 字段值是否有效的判断依据是前面的那些约束
1. 可以直接检测某个表单是否有效
1. validity属性
    - 告诉字段为什么有效或无效

### 禁用验证
1. novalidate属性:告诉表单不验证
1. formnovalidate属性
    - 如果多个提交按钮，可以在某个提交按钮写这个属性，则写了这个属性的按钮，点击后不提交表单
