# 表单脚本
## 概述
1. js最初应用，就是分担服务器处理表单的责任，打破处处依赖服务器的局面
## 基本知识
1. 概述
    - 在HTML中用`<form>`表示
    - js中表单对应的是HTMLFormElement类型，继承了HTMLElement
    - 取得引用的方式
        - getElementById
        - document.forms[]
1. 提交表单
    - 使用input或button，type为submit，可以提交表单
        - 如表单存在上述任何一种按钮，表单控件获得焦点时，按回车键就可以提交表单
        - 浏览器会在将请求发给服务器之前触发submit事件
    - js方式
        - 调用submit()方法
        - 表单中可以无提交按钮
        - 不会触发submit事件，可以在调用submit方法之前验证表单
    - 重复提交问题
        - 可以提交之后禁用提交按钮
        - 利用submit事件，取消后续的表单提交操作，注意不能使用onclick事件，因为有的浏览器触发submit事件之前触发onclick
1. 重置表单
    - 使用input或button，type为reset
        - 所有表单字段恢复到页面刚加载完毕时的初始值
        - 触发reset事件
    - js方式
        - 调用reset()方法
        - 不触发reset事件
    - 重置表单对用户不友好，很少用
1. 表单字段
    - 访问
        - 使用原生DOM
        - 使用表单Elements属性
            - 表单所有元素的集合
            - 是一个有序列表
            - 顺序与出现在标记顺序相同
            - 对于单选和多选，返回NodeList
        - 尽可能通过表单属性访问元素，只是为了与旧浏览器保持向后兼容的一种过渡方式
    - 共有的表单字段属性
        - 除了fieldset元素之外，所有表单都有的一组属性
        - form属性:只读，不能js修改
        - type属性:值等于HTML特性type值
    - 共有的表单字段方法
        - focus():可以当页面load之后，将光标移动到输入框的地方
        - blur()方法
        - autofocus属性
            - HTML5新增
            - 支持的，只要设置了这个属性，则会自动获得光标
        - 默认情况下，只有表单字段可以获得焦点，其他元素可以将tabIndex属性设置为-1，然后调用focus()方法
    共有的表单字段事件
        - blur事件
        - focus事件
        - change事件
            - input和textarea元素，失去焦点并value值改变时触发
            - select，选项改变时触发
        - blur事件和change事件的关系，并没有规定，先后顺序不知

## 文本框脚本
### 概述
1. input元素
    - size：文本框能显示的字符数
    - value：文本框初始值
    - maxlength：接受的最大长度
1. textarea元素
    - 初始值放在两个标记中间
    - 不能在html中指定最大字符数
1. 注意：处理文本框时，最好不要使用DOM方法，因为对value属性的修改，不一定反应在DOM中用户输入都保存在value属性中

### 选择文本
1. select()方法
    - 选择文本框的所有文本
    - 无参数
    - 作用：可以在修改页面，文本框获得焦点时选中文本，避免用户一个个字符删
1. 选择事件
    - 在选择文本框文本时，会触发select事件
    - 注意，并不知道何时触发，因浏览器而异
    - 调用select()方法也会触发select事件
1. 取得选择的文本
    - 通过select事件，知道了用户选择了文本，但不知道选择了什么文本
    - HTML5解决了这个问题，IE8之前不支持下面两个属性
    - selectionStart属性
    - selectionEnd属性
1. 选择部分文本
    - setSelectionRange()方法
        - 参数：第一个字符索引
        - 参数：最后一个字符索引
        - 要看到选择的文本，必须在调用setSelectionRange()之前或之后立即将焦点设置到文本框
    - IE8之前，不能用
1. 过滤输入
    - 屏蔽字符
        - 屏蔽所有按键操作，导致文本框变为只读
        - 如想屏蔽特定字符，可以检测keypress事件对应的字符编码，然后再决定响应
    - 操作剪贴板
       -  HTML5把剪贴板事件纳入规范
       - 访问剪贴板数据
            - 使用clipboardData对象
            - IE，这个对象是window对象的属性
            - 有些浏览器器，是event对象属性
            - 有些浏览器，只能在处理剪贴板数据事件期间，这个对象才有效
            - 故，为保证兼容性，最好只在剪贴板事件期间使用这个对象
1. 自动切换焦点
    - 用户填写当前字段到达指定数量，自动聚焦下一个字段
    - 使用keyup事件检测文本框长度，因为此事件在用户输入新字符后触发

## 选择框脚本
1. 概述
    - 通过`<select>`和`<option>`创建的
    - 选择框的value由当前选中项决定
        - 无选中value属性为空字符串
        - 选中，且设置html中value特性，value属性为value特性
        - 选中，没设置html中value特性，value属性为该项文本
    - DOM中
        - 每个option元素都有一个HTMLOptionElement对象
        - 这个对象有多个方便数据访问的属性
        - 不推荐用DOM方式（firstChild）访问，要用属性方式访问
    - change事件:只要选中就会触发
1. 选择选项
    - selectedIndex属性
        - 只允许选择一个数据
            - 选择框的type设置为selet-one
        - 选择多个数据
            - 设置这个属性，会导致取消以前的所有选项并选择指定的那一项
            - 读取：指挥返回选中项第一项的索引值
    - selected属性
        - 设置属性值为true，不会取消其他选中项的选择
        - 主要作用是确定用户选择了哪一项
            - 可以循环option集合
1. 添加选项
    - 使用DOM方式
    - 使用Option构造函数
        - new Option("text","value");
        - 兼容DOM的浏览器，会返回一个`<option>`元素，故可以使用appendChlid()
        - IE8之前会有问题
    - 新方式：add()方法
        - DOM规定必须接受两个参数
        - 要编写跨浏览器代码，最佳方案是
            - selectbox.add(newOption,undefined);
        - 这个方式是将newOption插到最后，如想插入到中间使用insertBefore()方法
1. 移除选项
    - DOM方法
        - removeChild()方法
    - remove()方法
        - 使用选择框remove()方法
        - 参数：要移除选项的索引
    - 设置相应选项为null
        - DOM出现之前浏览器遗留机制
        - 循环移除第一个选项，因为第一个选项删除，下面选项会自动向上移动
1. 移动和重排选项
    - appendChild()方法
        - 参数：传入一个文档中已有的元素，元素会从原父节点中删除再添加过来
    - 会重置每一个选项的index属性

## 表单序列化
1. js中利用表单字段的type属性，连同name和value属性一起实现对表单的序列化
1. 表单提交期间发送给服务器的数据
    - 表单的字段和值进行url编码，用&分隔
    - 不发送禁用表单字段
    - 只发勾选的复选和单选框，选中的select项的value
    - 不发送type为reset和button的按钮
    - 一般不包含任何按钮字段，因为结果字符串可能是通过其他方式提交的

## 富文本编辑器
### 概述
1. 富文本编辑，又称WYSIWYG(所见即所得)
1. 页面中嵌入空白的iframe
1. 然后在onload事件中将iframe.document.designMode = "on"

### 设置可编辑
#### designMode

1. document.designMode：控制整个文档是否可编辑。有效值为"on"和"off"
2. off：不可编辑
3. on：可以编辑

#### contenteditable属性

1. 全局属性，表示元素是否可被编辑

2. 可在html中设置，也可在js中使用

	```html
	<cite contenteditable="true">-- Write your own name here</cite>
	```

	```javascript
	window.body.contenteditable = true
	```

	- true表示可编辑


### 操作富文本
1. 与富文本交互，使用document.execCommand()方法
1. 可对文档执行预定义的命令，不同浏览器支持的命令不同，要注意
1. 注意：由于各个浏览器实现命令的方式不同，因此不要指望富文本编辑器会产生一致的HTML
1. queryCommandEnabled()方法
    - 检测区域是否允许传入某个命令
    - 返回true也不意味着实际可以执行命令，只能说明当前选择的文本执行相应命令是否合适
1. queryCommandState()方法
    - 确定是否已将指定命令应用到选择的文本
1. queryCommandValue()方法
    - 返回第一个方法的第三个参数


### 富文本选区
1. window.getSelection()或document.getSelection()：获取到Selection对象
1. getSelection()方法
    - window对象和document对象的属性
    - 返回一个selection对象
1. HTML5将getSelection()方法纳入标准


### 表单和富文本
1. 从技术层面，富文本不属于表单，里面的html不会提交到服务器
1. 通常是，讲iframe的html取出，然后放到表单一个隐藏字段中，和表单一起提交