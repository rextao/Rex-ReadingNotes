# 离线应用与客户端存储
## 概述
1. 支持离线应用是HTML5的一个重点
1. 离线web应用
    设备不上网的情况下，也能运行
1. 开发离线web应用的步骤
    - 应用知道设备能不能上网
    - 应用可以访问一定资源
    - 本地有一块空间保存数据

## 离线检测
1. navigator.onLine属性
    - true：设备能上网
    - false：设备离线
    - 关键是：浏览器必须知道设备能否访问网络
1. online事件
    - 网络从离线变为在线
1. offline事件
    - 从在线变为离线
1. 检测应用是否离线
    - 页面加载后，通过navigator.onLine获取初始的状态
    - 通过online和offline事件确定网络连接状态是否变化
    - 注意：要手工轮询onLine属性检测网络状态变化

## 应用缓存
1. H5应用缓存(application cache)，简称appcache
1. 专门为开发离线web应用而设计的，在浏览器缓存中分出来一块缓存区，用来缓存这部分数据
1. 要在缓存中保存数据，需要用一个描述文件（设置的选项非常多），列出要下载和缓存的资源
1. 应用离线缓存的意图
    - 确保离线资源可用
1. 相应的js API
    - 核心是：applicationCache对象
    - applicationCache.status属性
        - 表示应用缓存的当前状态
    - 还有很多相关事件

## 数据缓存
### Cookie
1. 最初是在客户端用于存储会话信息的
1. 要求服务器对任意HTTP请求发送Set-Cookie HTTP头作为响应的一部分
1. 限制
    - cookie在性质上是绑定在特定的域名下的
    - 每个域的cookie总数是有限的
    - 浏览器对cookie尺寸是有限制的
1. cookie构成
    - 域，路径，失效时间，secure标志是服务器给浏览器的指示，以指定何时发送cookie，这些参数不发回服务器
1. js中的cookie
    - document.cookie
        - 返回当前页面可用的所有cookie字符串，一系列用分号隔开
        - 所有名都是用URL编码的
    - 创建Cookie
        - document.cookie="username=John Doe";
            - 可以配置存在时间，默认关闭浏览器清除
            - 可以配置path，默认当前网页
    - 读取Cookie
        - var x = document.cookie;
            - 会读取全部cookie
    - 改变Cookie：和创建一致，覆盖旧的cookie
    - 删除Cookie：设置存在时间为0
1. 子cookie
    - 为绕开浏览器单个域名的cooki限制
    - name=name1=value&name2=value
        - 浏览器存一个key为name，实际里面有两个key-value对
    - 删除子cookie，不能将key置""，需获得cookie下所有子cookie，然后再删除具体的
1. 注意
    - 由于所有的cookie都是由浏览器作为请求头发送，包含大量信息会影响特定域的请求性能
    - cookie信息越大，完成对服务器请求的时间就越长

### Web存储机制
#### 概述
1. H5一部分
1. 为了克服cookie带来的一些限制，当数据需要严格控制在客户端上时，无须持续将数据发给服务器
1. 主要目的
    - 提供在cookie之外存储会话数据的途径
    - 提供一种大量可跨会话存在数据的机制
包括两个对象
    - window.sessionStorage
    - window.globalStorage

#### Storage类型
1. 提供了最大的存储空间来存储名值对
1. 每个项目作为属性存储在这个对象上
1. 虽然可以用属性直接修改存储的值，但为避免某个键覆盖已有成员，建议使用方法访问数据


#### sessionStorage对象
1. 存储特定于某个会话的数据，浏览器关闭数据销毁
1. 数据可以跨页面刷新而存在，浏览器崩溃并重启依然可用
1. Storage的实例

#### localStorage对象
1. 不能指定任何访问规则，规则事先就设定好了
1. 访问同一个localStorage对象，要求同一个域名（子域名无效），协议，端口号


#### storage事件
1. 对Storage对象的任何修改，都会在文档上触发storage事件


#### 限制
1. 对存储空间大小的限制是以每个来源（协议、域、端口号）为单位的
1. 一般是5M或2.5M

### IndexedDB
1. 概述
    - 浏览器中保存结构化数据的一种数据库
    - 方便保存和读取js对象，同时支持查询和搜索
    - window.indexedDB
1. 数据库
    - 最大特色是：使用对象保存数据，而不是使用表来存储
    - 一个indexedDB数据库，就是一组位于相同命名空间下的对象集合








